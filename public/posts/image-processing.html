<!doctype html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <title>WEBサービスの画像処理について - WEBサービス発注道場</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta property="og:title" content="WEBサービスの画像処理について" />
  <meta property="og:site_name" content="WEBサービス発注道場" />
  <meta property="og:description" content="WEBサービスの発注方法を身につけるためのプログラムです。WEBサービスの開発プロセスを学ぶ「スクール」という側面と、「発注コンサルティング」という側面を兼ねています。社内であれ、社外であれ、これからエンジニアを採用する場合であれ、エンジニアにコードを書いてもらうための方法を指導します。" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://dojo.codebot.io/posts/image-processing.html" />
  <meta property="og:image" content="http://dojo.codebot.io/img/posts/image-processing.jpg" />
  <meta name="twitter:card" content="summary" />
  <link rel="shortcut icon" href="../img/fav.ico">
  <link rel="stylesheet" type="text/css" href="../css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="../font-awesome/css/font-awesome.css">
  <link rel="stylesheet" type="text/css" href="../css/lity.css">
  <link rel="stylesheet" type="text/css" href="../css/posts.css">
  <script type="text/javascript" src="../js/jquery-2.1.3.min.js"></script>
  <script type="text/javascript" src="../js/bootstrap.min.js"></script>
  <script src="../js/lity.min.js"></script>
</head>
<body class="posts show">
<header>
  <div class="middle-content">
    <div class="header-nav">
      <a href="../index.html">
        <i class="fa fa-home"></i>
        <strong>トップ</strong>
      </a>
      <a href="index.html">
        <i class="fa fa-newspaper-o"></i>
        <strong>記事</strong>
      </a>
      <a href="https://docs.google.com/a/daraf.co.jp/forms/d/1IExex4cdIFgwxTyOOJq37aeQG8r8OewKfM7lLjHmRuU/viewform" target="_blank" class="contact">
        <i class="fa fa-envelope"></i>
        <strong>お問い合わせ</strong>
      </a>
    </div>
  </div>
</header>
<div class="article">
<div class="middle-content">
<div class="top-pop">
  <a href="https://docs.google.com/a/daraf.co.jp/forms/d/1TNE-FDB2So2sFV2ZqQ7R1yDLKkzJmSQGfiL2x1tL6Ao/viewform" target="_blank">
    <img src="../img/top-pop.png">
  </a>
</div>
<div class="title-head">
  <div class="dojo-logo">
    <img src="../img/top-title.png" class="inline-block middle title" height="22" alt="WEBサービス発注道場">
    <img src="../img/chara.png" class="inline-block middle logo" height="37px">
  </div>
  <h1>WEBサービスの画像処理について</h1>
  <div class="info">
    <div class="time inline-block middle">
      <i class="fa fa-clock-o inline-block middle"></i>
      <div class="inline-block middle">2016年5月25日</div>
    </div>
    <div class="author inline-block middle">
      <i class="fa fa-user inline-block middle"></i>
      <div class="inline-block middle">斉脇 一志</div>
    </div>
  </div>
</div>
<!-- 記事内容 -->
<img src="../img/posts/image-processing.jpg">

<h2>内容について</h2>
<p>ここでは、「WEBサービス発注道場」で扱う内容の一部を抜粋して紹介しています。
追加情報に興味がある方は、「WEBサービス発注道場」へお越しください。</p>
<p><a href="http://dojo.codebot.io#recuruitment"><img src="../img/banner.png"></a></p>

<h2>目次</h2>

<ol>
<li>画像選択</li>
<li>画像アップロード、ホスト/配信、ダウンロード</li>
<li>画像処理</li>
<li>画像解析</li>
</ol>


<h2>1.画像選択</h2>

<h3>クライアントでの選択方法</h3>

<ul>
<li>ブラウザ: HTMLのinputタグでtypeをfileにして、画像を選択

<ul>
<li>または、HTML5のDnD APIで複数枚のFileを取得する</li>
<li>jQueryにしろReactにしろ、それぞれやり方ある</li>
</ul>
</li>
<li>iOS: AlamofireでNSDataとしてファイルを選択する

<ul>
<li>カメラの起動、カメラロールからの取得など</li>
<li>Androidも同様(いくつかライブラリがある)</li>
</ul>
</li>
</ul>


<h3>参考</h3>

<ul>
<li><a href="http://www.html5rocks.com/ja/tutorials/dnd/basics/">ネイティブ HTML5 ドラッグ＆ドロップ - HTML5 Rocks</a></li>
<li><a href="http://qiita.com/gologo13/items/e7b1ed56b6692e388d4d">Alamofireでmultipart/form-dataリクエスト - Qiita</a></li>
</ul>


<h2>2.画像アップロード、ホスト/配信、ダウンロード</h2>

<h3>ファイルアップロード</h3>

<ul>
<li>multipart/form-dataでアップロードする</li>
</ul>


<p><a href="http://www.javadrive.jp/servlet/fileupload_tutorial/index2.html">フォームよるファイルアップロードの仕様</a></p>

<h3>画像の種類</h3>

<ul>
<li>pre-flightでアップロードするとしても、不正な画像でないかチェックする</li>
<li>jpg, pngかどうかチェックする</li>
<li>画像容量もチェックする(大きすぎるファイルは不正と判断する)</li>
</ul>


<p><a href="http://liginc.co.jp/web/design/material/50037">画像ファイル形式の基礎と特徴まとめ（JPEG・GIF・PNGなど） | 株式会社LIG</a></p>

<h3>ホスト/配信</h3>

<ul>
<li>WEBサーバーと同じ場所にホスト: Nginxが稼働しているファイルシステムと同じ場所にホスト</li>
<li>S3など専用ファイルサーバーにホスト: サーバー経由またはクライアントからダイレクトで送る</li>
<li>AkamaiなどのCDNから配信: CDNにキャッシュさせて配信する

<ul>
<li>CloudFront(AWS), Cloudflare, Fastlyなど</li>
</ul>
</li>
</ul>


<h3>pre-flightでS3に画像をアップ</h3>

<p>メインサーバーでは、選択された画像のメタデータだけ送信し、認証処理と画像のvalidationを完了したら、S3へのアクセストークンを返却し、クライアントから直接画像をS3にアップロードする。メインサーバーの負荷を減らすためにも、直接アップロードしたほうがお得。CORSに注意が必要。</p>

<h3>画像ダウンロードとクライアントでのキャッシュ</h3>

<ul>
<li>クライアントで画像を読み込む時は非同期で読み込むようにする</li>
<li>通信料を減らすため、同じ画像ファイルはできるだけクライアントでキャッシュしておく</li>
</ul>


<h3>データ転送量/送信量と利用料金</h3>

<p>転送量で課金されるので、画像共有サービスなどの場合注意が必要。</p>

<ul>
<li><a href="http://blog.mah-lab.com/2014/04/20/s3/">データ転送量が多いと、S3結構高いのよ | mah365</a></li>
<li><a href="http://qiita.com/hit/items/3151208b7f01aaa1ea9d">Amazon S3の利用料節約を考えてみる - Qiita</a></li>
</ul>


<h2>3.画像処理</h2>

<ul>
<li>圧縮(compression)</li>
<li>サイズ変更(resize)</li>
<li>拡大縮小(scale)</li>
<li>サムネイル(thumbnail)</li>
<li>切り出し(crop)</li>
<li>回転(lotate)</li>
<li>色変換/エフェクト(effect/filter)</li>
<li>合成</li>
<li>文字入れ</li>
</ul>


<h3>やりかた</h3>

<ul>
<li>サーバー: RubyやWEBサーバーで加工、圧縮、エンコードなど</li>
<li>ブラウザ: JSで加工する</li>
<li>iOS: Swiftで加工する</li>
<li>SaaS/API: AWS LambdaやAPIサービスで加工する</li>
</ul>


<h3>AWS Lambda + Node.js</h3>

<ul>
<li>AWS Lambdaにサムネイル作成用のNode.jsスクリプトをセットする</li>
<li>S3にアップロードされたイベントを拾って、Lambdaでサムネイルを作成し、別のBucketにサムネイルホスト</li>
<li>画像処理をEC2でやるよりも安価に画像処理ができる</li>
</ul>


<h3>Apache or Nginx</h3>

<p>ApacheやNginxなどのWEBサーバーのモジュールでサムネイルを作成する。CookpadなどはApacheでやっている(気がする)。</p>

<h3>参考</h3>

<ul>
<li><a href="http://gihyo.jp/dev/serial/01/ruby/0026">第26回　RMagickを用いた画像処理（1）リサイズ：Ruby Freaks Lounge｜gihyo.jp … 技術評論社</a></li>
<li><a href="http://qiita.com/scleen_x_x/items/f5d62f8cc8ba73096aa2">rubyで使える動画・画像解析ライブラリ ヽ(ﾟｰﾟ<em>ヽ)(ﾉ</em>ﾟｰﾟ)ﾉわぁい - Qiita</a></li>
<li><a href="http://qiita.com/scleen_x_x/items/14a80fd52e41dfcfb660">rubyで画像処理できるRMagickの紹介をするよ ヽ(ﾟｰﾟ<em>ヽ)(ﾉ</em>ﾟｰﾟ)ﾉわぁい - Qiita</a></li>
<li><a href="https://github.com/globchastyy/SwiftUIImageEffects">globchastyy/SwiftUIImageEffects: Swift port of Apple UIImage+UIImageEffecs category.</a></li>
<li><a href="http://opencv.blog.jp/html5/%E7%94%BB%E5%83%8F%E5%87%A6%E7%90%86%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA">HTML5/Javascriptの画像処理ライブラリまとめ</a></li>
<li><a href="http://qiita.com/s_s_k/items/4f18d0a9f8a9f53decfd">JSで顔認識(Face Detection) - Qiita</a></li>
</ul>


<h2>4.画像解析</h2>

<h3>よくやること</h3>

<ul>
<li>メタデータの収集と編集</li>
<li>OCRで文字認識</li>
<li>顔の判定/抽出</li>
<li>特徴抽出</li>
</ul>


<h3>やりかた</h3>

<ul>
<li>メタデータ(日時やGPSデータなど)を処理する場合がある

<ul>
<li>Twitterでは画像のGPSデータを安全性のため削除している(ストーカー対策)</li>
</ul>
</li>
<li>OpenCVのラッパーを使う: JS, Swift, Rubyでもある</li>
<li>CPU/GPUの負荷や機械学習が必要なケースが多いのでサーバー側で処理するイメージだったが、Snapchatの顔識別などのようにクライアントで処理をするケースもある</li>
<li>SaaS/API(GCP, AWS, Azure): APIの呼び出し数だけお金を払えば、機械学習済みの画像認識エンジンを利用することができる。GCPのCloud Visionなど高精度でOCRなどが可能。</li>
</ul>
<!-- /記事内容 -->
<div class="application-box">
  <div class="text center">
    WEBサービス発注道場のお申し込みはこちら
    <div class="arrow">↓↓↓</div>
  </div>
  <a href="https://docs.google.com/a/daraf.co.jp/forms/d/1TNE-FDB2So2sFV2ZqQ7R1yDLKkzJmSQGfiL2x1tL6Ao/viewform" class="btn"><i class="fa fa-sign-in"></i> お申し込みはこちら</a>
</div>
<div class="codebot-facebook">
  <iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fcodebotio%2F&tabs&width=500&height=155&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=true&appId" width="500" height="155" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
</div>
</div>
</div>
<div class="copyright center">
  Copyright © 2016 CodebotDojo. All rights reserved.
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77798333-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>